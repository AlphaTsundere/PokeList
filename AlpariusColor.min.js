(function (h) {
  'use strict';
  h = (h || '').toLowerCase();
  if (h !== 'pokemon-alparius.foroactivo.com' && h !== 'www.pokemon-alparius.foroactivo.com') return;

  try {
/*
  Panel de tema extendible (Light/Dark)*/


(function(){
  const LS_LIGHT = 'foroTemaLight';
  const LS_DARK  = 'foroTemaDark';

  // Flags de estado
  let didInitialApply = false;   // aplicamos localStorage sólo una vez
  let saveTimer = null;
  let moTimer = null;            // debounce del MutationObserver

  // Etiquetas legibles para cada variable
  const VAR_LABELS = {
    '--light-grad-stop1': 'Gradiente inicio',
    '--light-grad-stop2': 'Gradiente medio',
    '--light-grad-stop3': 'Gradiente final',
    '--light-post-color1': 'Font post',
    '--light-indice-color': 'Fondo transparente indice 1',
    '--light-indice-transparente': 'Fondo transparente indice 2',
    '--light-uno-color': 'Color primario',
    '--light-dos-color': 'Color secundario',
    '--light-tres-color': 'Fondo',
    '--light-cuatro-color': 'Transparencia',
    '--light-cinco-color': 'Texto',
    '--light-seis-color': 'Links 1',
    '--light-siete-color': 'Fondo transparente anuncios',
    '--light-ocho-color': 'Links 2',
    '--light-nueve-color': 'Fondo posts',
    '--dark-grad-stop1': 'Gradiente inicio',
    '--dark-grad-stop2': 'Gradiente medio',
    '--dark-grad-stop3': 'Gradiente final',
    '--dark-post-color1': 'Font post',
    '--dark-indice-color': 'Fondo transparente indice 1',
    '--dark-indice-tinte': 'Color transparente imagenes',
    '--dark-uno-color': 'Color primario',
    '--dark-dos-color': 'Color secundario',
    '--dark-tres-color': 'Fondo',
    '--dark-cuatro-color': 'Transparencia',
    '--dark-cinco-color': 'Texto',
    '--dark-seis-color': 'Links 1',
    '--dark-siete-color': 'Fondo transparente anuncios',
    '--dark-ocho-color': 'Fondo posts',
  };

  // === Variables existentes ===
  const VARS_LIGHT = [
    '--light-grad-stop1',
    '--light-grad-stop2',
    '--light-grad-stop3',
    '--light-post-color1',
    '--light-indice-color',
    '--light-indice-transparente',
    '--light-uno-color',
    '--light-dos-color',
    '--light-tres-color',
    '--light-cuatro-color',
    '--light-cinco-color',
    '--light-seis-color',
    '--light-siete-color',
    '--light-ocho-color',
    '--light-nueve-color',
  ];
  const VARS_DARK = [
    '--dark-grad-stop1',
    '--dark-grad-stop2',
    '--dark-grad-stop3',
    '--dark-post-color1',
    '--dark-indice-color',
    '--dark-indice-tinte',
    '--dark-uno-color',
    '--dark-dos-color',
    '--dark-tres-color',
    '--dark-cuatro-color',
    '--dark-cinco-color',
    '--dark-seis-color',
    '--dark-siete-color',
    '--dark-ocho-color',
  ];


  // === Utilidades ===
  const $r = () => document.documentElement;
  const getVar = v => getComputedStyle($r()).getPropertyValue(v).trim();
  const setVar = (v,val) => $r().style.setProperty(v, val);
  const save = (k, arr) => localStorage.setItem(k, JSON.stringify(arr));
  const load = k => { try { return JSON.parse(localStorage.getItem(k)||'[]'); } catch { return []; } };
  const apply = (vars, values) => vars.forEach((v,i)=> values[i] && setVar(v, values[i]));

  // === UI ===
  const CSS = `
    .ft-btn { position: fixed; left: 14px; bottom: 14px; z-index: 9999;
      padding: 8px 10px; border-radius: 10px; border: 1px solid #00000033; cursor: pointer; font: 600 13px system-ui;
      box-shadow: 0 6px 24px rgba(0,0,0,.35); }
    .ft-panel { position: fixed; left: 14px; bottom: 56px; z-index: 9999;
      width: 320px; max-height: 65vh; overflow:auto; padding: 10px;
      background: #121212; color: #eee; border: 1px solid #00000044;
      border-radius: 12px; box-shadow: 0 20px 48px rgba(0,0,0,.45); display:none; }
    .ft-row { display:flex; align-items:center; gap:8px; margin:6px 0; }
    .ft-row label { flex: 1 1 auto; font-size: 12px; opacity:.9; }
    .ft-row input[type="color"] { width: 36px; height: 26px; padding:0; border:none; background:transparent; }
    .ft-head { display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; }
    .ft-actions { display:flex; gap:6px; }
    .ft-btn-small { padding:4px 8px; font: 600 12px system-ui; border-radius:8px; border:1px solid #00000033; background:#1d1d1d; color:#fff; cursor:pointer; }
    details.ft-acc { border:1px solid #ffffff10; border-radius:10px; margin:8px 0; }
    details.ft-acc > summary { list-style:none; cursor:pointer; padding:8px 10px; font:600 13px system-ui; }
    details.ft-acc[open] > summary { background:#ffffff08; border-bottom:1px solid #ffffff10; border-top-left-radius:10px; border-top-right-radius:10px; }
    .ft-acc .ft-body { padding:8px 10px; }
    .ft-row input[type="range"]{ accent-color:#888; }
  `;
  function ensureCss(){
    if (!document.getElementById('ft-css')){
      const st = document.createElement('style'); st.id='ft-css'; st.textContent = CSS; document.head.appendChild(st);
    }
  }

  // Tema actual + sincronizar acordeón
  function getCurrentTheme(){
    const dt = document.body && document.body.getAttribute('data-theme');
    if (dt === 'light' || dt === 'dark') return dt;
    return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }
  function syncAccordionByTheme(panel){
    const t = getCurrentTheme();
    const accLight = panel.querySelector('.js-acc-light');
    const accDark  = panel.querySelector('.js-acc-dark');
    if (!accLight || !accDark) return;
    accLight.open = (t === 'light');
    accDark.open  = (t === 'dark');
  }

  // --- Helpers de color con alpha ---
  function clamp01(x){ return Math.max(0, Math.min(1, x)); }
  function hex(n){ return n.toString(16).padStart(2,'0'); }
  function rgbToHex6(r,g,b){ return '#' + [r,g,b].map(v=>hex(v)).join(''); }
  function hex6ToHex8(hex6, a){
    const aa = hex(Math.round(clamp01(a)*255));
    return hex6 + aa;
  }
  function expand3(h){ return '#'+h[1]+h[1]+h[2]+h[2]+h[3]+h[3]; }

  // Normaliza colores → {hex6, a}
  function parseColor(val){
    const v = (val||'').trim();
    let m = v.match(/^#([0-9a-fA-F]{8})$/);
    if (m){
      const rr = m[1].slice(0,2), gg = m[1].slice(2,4), bb = m[1].slice(4,6), aa = m[1].slice(6,8);
      return { hex6: '#'+rr+gg+bb, a: parseInt(aa,16)/255 };
    }
    m = v.match(/^#([0-9a-fA-F]{3})$/);
    if (m) return { hex6: expand3('#'+m[1]), a: 1 };
    m = v.match(/^#([0-9a-fA-F]{6})$/);
    if (m) return { hex6: '#'+m[1], a: 1 };
    m = v.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([0-9.]+))?\)$/i);
    if (m){
      const [r,g,b] = m.slice(1,4).map(Number);
      const a = m[4] !== undefined ? parseFloat(m[4]) : 1;
      return { hex6: rgbToHex6(r,g,b), a: clamp01(a) };
    }
    return { hex6:'#000000', a:1 };
  }

  // === UI: fila con color + opacidad (live)
  function makeRow(vname){
    const row = document.createElement('div'); row.className='ft-row';
    const lab = document.createElement('label');
    lab.textContent = VAR_LABELS[vname] || vname;

    const { hex6, a } = parseColor(getVar(vname));

    const inp = document.createElement('input');
    inp.type = 'color';
    inp.value = hex6;

    const aWrap = document.createElement('div');
    aWrap.style.display='flex';
    aWrap.style.alignItems='center';
    aWrap.style.gap='6px';

    const aRange = document.createElement('input');
    aRange.type='range'; aRange.min='0'; aRange.max='100';
    aRange.value = String(Math.round(a*100));
    aRange.style.flex='0 0 90px';

    const aVal = document.createElement('span');
    aVal.style.fontSize='11px';
    aVal.style.opacity='.8';
    aVal.textContent = aRange.value + '%';

    function updateVar(){
      const alpha = Number(aRange.value)/100;
      const hex8 = hex6ToHex8(inp.value, alpha); // #RRGGBBAA
      setVar(vname, hex8);
      scheduleSave();
    }

    inp.addEventListener('input', updateVar);
    inp.addEventListener('change', updateVar);
    aRange.addEventListener('input', ()=>{ aVal.textContent = aRange.value + '%'; updateVar(); });

    aWrap.append(aRange, aVal);
    row.append(lab, inp, aWrap);
    row.title = vname;
    return row;
  }

  function scheduleSave(){
    clearTimeout(saveTimer);
    saveTimer = setTimeout(doSave, 80);
  }
  function doSave(){
    const lightVals = VARS_LIGHT.map(v=>getVar(v) || '');
    const darkVals  = VARS_DARK.map(v=>getVar(v) || '');
    save(LS_LIGHT, lightVals);
    save(LS_DARK, darkVals);
  }
  function resetScheme(varsKey, varsList){
    localStorage.removeItem(varsKey);
    varsList.forEach(v=> $r().style.removeProperty(v));
    doSave();
  }

  // === Export / Import ===
  function snapshotVars(){
    const kv = {};
    [...VARS_LIGHT, ...VARS_DARK].forEach(v => { kv[v] = getVar(v) || ''; });
    return kv;
  }
  function applyVarsObject(obj){
    if (!obj || typeof obj!=='object') return;
    Object.entries(obj).forEach(([k,val])=>{
      if (typeof val === 'string') setVar(k, val);
    });
    const lightVals = VARS_LIGHT.map(v=> getVar(v) || '');
    const darkVals  = VARS_DARK .map(v=> getVar(v) || '');
    save(LS_LIGHT, lightVals);
    save(LS_DARK,  darkVals);
  }
  function exportColors(){
    const payload = { schema: 'foro-theme-v1', createdAt: new Date().toISOString(), values: snapshotVars() };
    const blob = new Blob([JSON.stringify(payload, null, 2)], { type:'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'colores-foro.json';
    document.body.appendChild(a);
    a.click();
    setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 0);
  }
  function importColorsFromFile(file){
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try {
        const data = JSON.parse(String(reader.result||'{}'));
        const values = data.values || data;
        applyVarsObject(values);
        console.log('Colores importados ✔');
      } catch(e){
        console.error('JSON inválido al importar colores', e);
        alert('No se pudo importar: JSON inválido.');
      }
    };
    reader.readAsText(file);
  }

(function () {
  const msg = "SPAlJan – NoC";
  if (typeof console !== 'undefined') console.log("%c" + msg, "color:green;font-size:13px;");
})();

  // --- CONSTRUCCIÓN DEL PANEL ---
  function buildPanel(){
    const panel = document.createElement('div');
    panel.className='ft-panel';

    panel.innerHTML = `
      <div class="ft-head">
        <div style="font:700 13px system-ui">Personalizar colores</div>
        <div class="ft-actions">
          <button class="ft-btn-small js-export" title="Exportar colores"><i class="fa-solid fa-download"></i></button>
          <button class="ft-btn-small js-import" title="Importar colores"><i class="fa-solid fa-upload"></i></button>
          <input type="file" accept="application/json" class="ft-file" style="display:none" />
          <button class="ft-btn-small js-reset-light" title="Reset light">Reset light</button>
          <button class="ft-btn-small js-reset-dark" title="Reset dark">Reset dark</button>
        </div>
      </div>

      <details class="ft-acc js-acc-light">
        <summary><i class="fa-solid fa-sun"></i> Cambiar colores light</summary>
        <div class="ft-body js-light"></div>
      </details>

      <details class="ft-acc js-acc-dark">
        <summary><i class="fa-solid fa-moon"></i> Cambiar colores dark</summary>
        <div class="ft-body js-dark"></div>
      </details>
    `;

    const fileInput = panel.querySelector('.ft-file');
    panel.querySelector('.js-export').addEventListener('click', exportColors);
    panel.querySelector('.js-import').addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', (e)=>{
      const f = e.target.files && e.target.files[0];
      importColorsFromFile(f);
      e.target.value = '';
    });

    const lightBox = panel.querySelector('.js-light');
    const darkBox  = panel.querySelector('.js-dark');
    VARS_LIGHT.forEach(v=> lightBox.appendChild(makeRow(v)));
    VARS_DARK.forEach(v=> darkBox.appendChild(makeRow(v)));

    panel.querySelector('.js-reset-light').addEventListener('click', ()=> resetScheme(LS_LIGHT, VARS_LIGHT));
    panel.querySelector('.js-reset-dark').addEventListener('click', ()=> resetScheme(LS_DARK, VARS_DARK));

    // Sincroniza acordeón (abre el que corresponda al tema actual)
    syncAccordionByTheme(panel);

    return panel;
  }

  function mount(){
    ensureCss();

    // Aplicar guardados SOLO una vez (primer boot) para no pisar cambios live
    if (!didInitialApply){
      const light = load(LS_LIGHT);
      const dark  = load(LS_DARK);
      if (light.length) apply(VARS_LIGHT, light);
      if (dark.length)  apply(VARS_DARK,  dark);
      didInitialApply = true;
    }

    // Botón flotante (crear si no existe)
    let btn = document.querySelector('.ft-btn');
    if (!btn){
      btn = document.createElement('button');
      btn.className = 'ft-btn';
      btn.textContent = 'Tema';
      document.body.appendChild(btn);
    }

    // Panel (crear si no existe)
    let panel = document.querySelector('.ft-panel');
    if (!panel){
      panel = buildPanel();
      document.body.appendChild(panel);
    }

    btn.onclick = () => {
      const p = document.querySelector('.ft-panel');
      if (p) syncAccordionByTheme(p); // sincroniza acordeón según tema actual
      const isHidden = p.style.display==='none' || !p.style.display;
      p.style.display = isHidden ? 'block' : 'none';
    };
  }

  function boot(){ mount(); }
  if (document.readyState==='loading') document.addEventListener('DOMContentLoaded', boot); else boot();

  // Rehidrata en mutaciones del DOM (por si el foro recarga secciones)
  // → Debounce: asegura existencia de UI sin re-aplicar localStorage
  const mo = new MutationObserver(()=>{
    if (moTimer) cancelAnimationFrame(moTimer);
    moTimer = requestAnimationFrame(()=>{
      mount();
      const p = document.querySelector('.ft-panel');
      if (p) syncAccordionByTheme(p); // re-sincroniza acordeón
    });
  });

  // Observa el documento para re-montar UI
  mo.observe(document.documentElement, { childList:true, subtree:true });

  // Observa cambios de data-theme en <body>, pero solo cuando exista
  function observeBodyTheme(){
    const b = document.body;
    if (!b) return;
    mo.observe(b, { attributes:true, attributeFilter:['data-theme'] });
  }
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', observeBodyTheme, { once:true });
  } else {
    observeBodyTheme();
  }
})();
  
  } catch (e) {

      }
})(location.hostname);
    
    
  
